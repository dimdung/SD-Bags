Environment

Red Hat Enterprise Linux 6
RAW devices
Issue

Unable to create RAW devices in Red Hat Enterprise Linux 6. How do I create RAW devices ?
Resolution

There is no default service for raw devices in Red Hat Enterpseis Linux 6(RHEL6). So RAW devices needs to be bind by /etc/udev/rules.d/60-raw.rulesby following below procedure:

Creating the raw devices using udev

Nevertheless, to create raw devices, add entries to /etc/udev/rules.d/60-raw.rules in the following formats:

For device names:
Raw
ACTION=="add|change", KERNEL=="<device name>", RUN+="/bin/raw /dev/raw/rawX %N"
For major / minor numbers:
Raw
ACTION=="add|change", ENV{MAJOR}="A", ENV{MINOR}="B", RUN+="/bin/raw /dev/raw/rawX %M %m"
Note: Replace with the name of the device needed to bind (such as /dev/sda1). "A" and "B" are the major / minor numbers of the device needed for binding, an "X" is the raw device number that the system wants to use.

Creating persistent raw devices for single path LUNs (permissions in this case for oracle db)

If using unpartitioned LUNs, to create a single raw device for the whole LUN use this rule format:
Raw
ACTION=="add|change", KERNEL=="sd*[!0-9]", PROGRAM=="/sbin/scsi_id -g -u -d %N", RESULT=="3600601601bd2180072193a9242c3dc11", RUN+="/bin/raw /dev/raw/raw1 %N", OWNER="grid", GROUP="asmadmin", MODE="0660"
If using partitioned LUNs, where raw devices are created for each of the partitions on the LUN, use this rule format:
Raw
ACTION=="add|change", KERNEL=="sd*[0-9]", PROGRAM=="/sbin/scsi_id -g -u -d %N", RESULT=="3600601601bd2180072193a9242c3dc11", RUN+="/bin/raw /dev/raw/raw1 %N", OWNER="grid", GROUP="asmadmin", MODE="0660"
If creating raw devices from multipath devices, use this rule format:
Raw
ACTION=="add|change", KERNEL=="dm-[0-9]*", PROGRAM="/sbin/scsi_id -g -u -d %N", RESULT=="3600a098033303433515d4661454e4658", RUN+="/bin/raw /dev/raw/raw1 %N", OWNER="grid", GROUP="asmadmin", MODE="0660"
Set the RESULT value to the output of scsi_id -g -u -d /block/sdX (where sdX is the current path to the LUN). This will create the raw device /dev/raw/raw1 that will be persistently bound to the LUN with WWID 3600601601bd2180072193a9242c3dc11.

Setting ownership and permissions on the raw devices. Point 2 will set permissions on the dm device.

To set specific ownership and/or permissions for the raw devices, add entries to /etc/udev/rules.d/60-raw.rules in the following format:

Raw
ACTION=="add|change", KERNEL=="raw*", OWNER="grid", GROUP="asmadmin", MODE="0660"
Testing and implementing the udev rules

Before implementing them, use the udevadm test command to verify the udev rules work as expected. To verify that the raw device is created for a specific disk or partition, eg /dev/sdb1:

Raw
[root@host]# udevadm test /block/sdb/sdb1 | grep raw
main: run: '/bin/raw /dev/raw/raw1 /dev/.tmp-8-17'
To check ownership/permission settings for a particular raw device, e.g. /dev/raw/raw1:

Raw
[root@host]# udevadm test /class/raw/raw1 | grep mode
udev_node_add: creating device node '/dev/raw/raw1', major = '162', minor = '1', mode = '0600', uid = '0', gid = '0'
Finally, to actually create the raw device(s), trigger udev

Raw
[root@host]# udevadm trigger
Check that the raw device(s) have been created

Raw
[root@host]# raw -qa
/dev/raw/raw1:  bound to major 8, minor 17

[root@host]# ls -l /dev/raw
total 0
crw-rw---- 1 grid   asmadmin 162,  1 Jan 29 02:47 raw1
Root Cause

Red Hat Enterprise Linux 6 does not have raw devices services.


### 
[root@eagu62 ~]# cat /etc/udev/rules.d/60-raw.rules
-----START------
# Enter raw device bindings here.
#
# An example would be:
#   ACTION=="add", KERNEL=="sda", RUN+="/bin/raw /dev/raw/raw1 %N"
# to bind /dev/raw/raw1 to /dev/sda, or
#   ACTION=="add", ENV{MAJOR}=="8", ENV{MINOR}=="1", RUN+="/bin/raw /dev/raw/raw2 %M %m"
# to bind /dev/raw/raw2 to the device with major 8, minor 1.
ACTION!="add|change", GOTO="raw_end"
# Create raw character device mapping:
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_system_main.iq", RUN+="/bin/raw /dev/raw/raw1 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_01.iq", RUN+="/bin/raw /dev/raw/raw2 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_02.iq", RUN+="/bin/raw /dev/raw/raw3 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_03.iq", RUN+="/bin/raw /dev/raw/raw4 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_04.iq", RUN+="/bin/raw /dev/raw/raw5 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_05.iq", RUN+="/bin/raw /dev/raw/raw6 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_06.iq", RUN+="/bin/raw /dev/raw/raw7 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_07.iq", RUN+="/bin/raw /dev/raw/raw8 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_main_08.iq", RUN+="/bin/raw /dev/raw/raw9 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_temp_01.iqtmp", RUN+="/bin/raw /dev/raw/raw10 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_temp_02.iqtmp", RUN+="/bin/raw /dev/raw/raw11 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_temp_03.iqtmp", RUN+="/bin/raw /dev/raw/raw12 %N"
ENV{DM_VG_NAME}=="rawdev_vg", ENV{DM_LV_NAME}=="iq_eagu62_temp_04.iqtmp", RUN+="/bin/raw /dev/raw/raw13 %N"
# To set permissions:
KERNEL=="raw*", OWNER:="sybase", GROUP:="sybsa", MODE:="0770"
LABEL="raw_end"
-----END------
[root@eagu62 raw]# cat /etc/rc.local
### for Raw devices
ln -s /dev/raw/raw1 /opt/sw/sybase_iq/dbfiles/iq_eagu62_system_main.iq
ln -s /dev/raw/raw2 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_01.iq
ln -s /dev/raw/raw3 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_02.iq
ln -s /dev/raw/raw4 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_03.iq
ln -s /dev/raw/raw5 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_04.iq
ln -s /dev/raw/raw6 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_05.iq
ln -s /dev/raw/raw7 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_06.iq
ln -s /dev/raw/raw8 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_07.iq
ln -s /dev/raw/raw9 /opt/sw/sybase_iq/dbfiles/iq_eagu62_main_08.iq
ln -s /dev/raw/raw10 /opt/sw/sybase_iq/dbfiles/iq_eagu62_temp_01.iqtmp
ln -s /dev/raw/raw11 /opt/sw/sybase_iq/dbfiles/iq_eagu62_temp_02.iqtmp
ln -s /dev/raw/raw12 /opt/sw/sybase_iq/dbfiles/iq_eagu62_temp_03.iqtmp
ln -s /dev/raw/raw13 /opt/sw/sybase_iq/dbfiles/iq_eagu62_temp_04.iqtmp
[root@eagu62 raw]# cat /etc/rc.local
